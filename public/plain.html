<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>Multi-player Tic-Tac-Toe powered by PubNub</title>
  <meta name="description" content="Simple Chat Room">
  <meta name="author" content="Tomomi Imura  @girlie_mac">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <!-- Google Tag Manager -->
  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PZWSZ2"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-PZWSZ2');</script>
  <!-- End Google Tag Manager -->

  <header>
    <a href="index.html">PubNub JavaScript Example</a>
  </header>

  <section class="masthead">
    <h1>Multi-player Tic-Tac-Toe</h1>
  </section>

  <section class="main">

    <section class="demo">
      <h2>How to Play</h2>

      <p><strong>You (X):</strong>
      <ol>
        <li>Stay on this browser</li>
        <li>Play when your opponent is ready</li>
      </ol>
      </p>

      <p><strong>Your opponent (O):</strong>
      <ol>
        <li>Open an another browser tab or window.</li>
        <li>In the new browser tab or window, go to: <span id="gameIdQuery"></span>
        <!-- <strong>pubsub.html?id=<span id="gameIdQuery"></span></strong></li> -->
      </ol>
      </p>

      <section class="game">
        <div class="col">
          &nbsp;
        </div>

        <div class="col">
          <div id="tictactoe" class="disabled"></div>
        </div>

        <div class="col">
          Game ID: <strong id="gameId"></strong>
          <br>
          You: <span id="you"></span>
          <br>
          <span id="whosTurn">It is your turn!</span>
        </div>

      </section>

    </section>

  </section>

 	<footer>
   <div id="container">
	   <div id="namesWrapper">
		 <h2>Chat</h2>
			<p>create Username:</p>
			<div id="error"></div>
				<form id="usernameForm">
					<input type="text" size="35" id="username">
					<input type="submit" value="Submit">
				</form>	
		</div>
		<div id="mainWrapper">
			<h2>Chat</h2>
				<div id="chatWrapper">
					<div id="chatWindow">	</div>
					<form id="messageForm">
						<input type="text" size="25" id="message" placeholder="say something..">
						<input type="submit" value="Submit">
					</form>
				</div>
				<div id="userWrapper">
				<div id="users"></div>
				</div>
		</div>
	</div>
	</footer>

  <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.0/socket.io.dev.js"></script>
   <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.15.1.min.js"></script>
   <script src="js/app.js"></script>	
	<script>
	$(function(){
	var socket = io.connect();
	var messageForm = $('#messageForm');
	var message = $('#message');
	var chat = $('#chatWindow');
	var usernameForm = $('#usernameForm');
	var users = $('#users');
	var username = $('#username');
	var error = $('#error');
	
	usernameForm.submit(function(e){
	e.preventDefault();
	socket.emit('new user',username.val(),function(data){
	if(data){
	$('#namesWrapper').hide();
	$('#mainWrapper').show();
	}else{
	$error.html('Username is taken');
	}
	});
	});
	
	socket.on('usernames',function(data){
	var html ='';
	for(i=0; i<data.length; i++){
	 html += data[i]+'</br>';
	}
	users.html(html);
	});
	
	messageForm.submit(function(e){
	e.preventDefault();
	socket.emit('send message',message.val());
	message.val('');
	});
	
	socket.on('new message',function(data){
	chat.append('<strong>'+data.user+'</strong>:'+data.msg+'</br>');
	});
	});
	</script>


</body>
</html>
